# Survey Management System - MongoDB Schema

This repository contains the MongoDB schema design for a Survey Management System that allows administrators to create surveys, collect user consent, and generate reports while maintaining user anonymity when required.

## Schema Overview

The database schema consists of the following collections:

### 1. Surveys Collection
Stores information about each survey:
- `name`: Title of the survey
- `publishDate`: Date when the survey becomes available
- `durationDays`: Duration (in days) survey remains open
- `endDate`: Calculated end date based on publishDate and durationDays
- `department`: Target department for the survey (null if targeting all departments)
- `targetEmployees`: Array of employee IDs if targeting specific users
- `createdBy`: ID of the admin who created the survey
- `createdAt`: Timestamp when the survey was created
- `updatedAt`: Timestamp when the survey was last updated
- `status`: Current status of the survey (draft, pending_consent, active, completed, archived)
- `consentDeadline`: Deadline for providing consent (same as publishDate)

### 2. Questions Collection
Stores survey questions and their options:
- `surveyId`: Reference to the survey this question belongs to
- `questionText`: The text of the question
- `options`: Array of options for the question (min 2, max 4)
- `parameter`: Optional parameter for categorization
- `order`: Order of the question in the survey

### 3. Consents Collection
Tracks user consent for each survey:
- `userId`: ID of the user
- `surveyId`: Reference to the survey
- `consentGiven`: Whether consent was given
- `timestamp`: When consent was given or denied
- `consentToken`: Unique token for consent verification link
- `emailSent`: Whether consent email was sent to the user
- `emailSentAt`: When consent email was sent

### 4. Responses Collection
Stores user responses to survey questions:
- `surveyId`: Reference to the survey
- `questionId`: Reference to the question
- `userId`: ID of the user (null if anonymous/no consent)
- `selectedOption`: The selected option
- `submittedAt`: When the response was submitted
- `anonymous`: Whether this response is anonymous (no user consent)

### 5. Notifications Collection
Tracks notifications sent to users:
- `userId`: ID of the user to notify
- `surveyId`: Reference to the survey
- `type`: Type of notification (consent_request, survey_available, manager_notification, reportee_notification)
- `sent`: Whether notification was sent
- `sentAt`: When notification was sent
- `deliveryStatus`: Status of the notification delivery
- `relatedToUserId`: For manager/reportee notifications, the ID of the related user

### 6. Users Collection
Stores user information (for reference):
- `email`: User's email address
- `name`: User's full name
- `department`: User's department
- `role`: User's role in the system (admin, employee, manager)
- `managerId`: ID of the user's manager (null if no manager)
- `directReports`: Array of user IDs who report to this user

### 7. Survey Attempts Collection
Tracks who has taken the survey:
- `surveyId`: Reference to the survey
- `userId`: ID of the user (null if anonymous)
- `startedAt`: When the survey was started
- `completedAt`: When the survey was completed (null if not completed)
- `completed`: Whether the survey was completed
- `anonymous`: Whether this attempt is anonymous

## Workflow Implementation

The schema supports the following workflow:

1. **Survey Creation**:
   - Admin creates a survey in the `surveys` collection
   - Questions are uploaded to the `questions` collection

2. **Consent Process**:
   - System creates entries in the `consents` collection with unique tokens
   - Consent emails are sent and tracked in the `notifications` collection
   - Users can provide consent before the publish date

3. **Survey Publication**:
   - On the publish date, notifications are sent to consenting users, their managers, and reportees
   - These notifications are tracked in the `notifications` collection

4. **Survey Participation**:
   - User attempts are tracked in the `surveyAttempts` collection
   - Responses are stored in the `responses` collection
   - For users without consent, responses are stored anonymously (userId = null)

5. **Reporting**:
   - Reports can be generated by querying the `responses` collection
   - User-specific reports are only available for users who gave consent

## Indexes

The schema includes indexes for optimizing common queries:
- Surveys by publish date, status, and department
- Questions by survey ID and order
- Consents by user ID and survey ID
- Responses by survey ID, question ID, and user ID
- Notifications by user ID, survey ID, and type
- Survey attempts by survey ID, user ID, and completion status

## Usage

To implement this schema in MongoDB:

1. Connect to your MongoDB instance
2. Run the `survey_management_schema.js` script to create the collections and indexes
3. Implement application logic to interact with these collections according to the workflow described above

